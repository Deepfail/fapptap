---
title: ç¼–å†™æ’ä»¶æƒé™
sidebar:
  order: 11
i18nReady: true
---

import { Steps } from '@astrojs/starlight/components';
import ShowSolution from '@components/ShowSolution.astro'
import Cta from '@fragments/cta.mdx';

æœ¬ç»ƒä¹ çš„ç›®æ ‡æ˜¯æ›´å¥½åœ°ç†è§£åœ¨ç¼–å†™è‡ªå·±çš„æ’ä»¶æ—¶å¦‚ä½•åˆ›å»ºæ’ä»¶æƒé™ã€‚

åœ¨æœ€åï¼Œä½ å°†èƒ½å¤Ÿä¸ºæ’ä»¶åˆ›å»ºç®€å•çš„æƒé™ã€‚ä½ å°†è·å¾—ä¸€ä¸ª 
Tauri æ’ä»¶ç¤ºä¾‹ï¼Œå…¶ä¸­æƒé™éƒ¨åˆ†æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œéƒ¨åˆ†æ˜¯æ‰‹åŠ¨è®¾ç½®çš„ã€‚

<Steps>

1. ### åˆ›å»º Tauri æ’ä»¶

    åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Tauri [`cli`](/reference/cli/) å¼•å¯¼ç”Ÿæˆä¸€ä¸ª Tauri æ’ä»¶æºä»£ç ç»“æ„ã€‚
    è¯·ç¡®ä¿å·²å®‰è£…æ‰€æœ‰å¿…å¤‡ [ç»„ä»¶](/start/prerequisites/) ï¼Œå¹¶é€šè¿‡è¿è¡Œ 
    `cargo tauri info` éªŒè¯ä½ çš„ Tauri CLI ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ã€‚

    è¾“å‡ºåº”è¡¨æ˜ `tauri-cli` ç‰ˆæœ¬ä¸º `2.x` ã€‚
    æˆ‘ä»¬å°†ä½¿ç”¨ `pnpm` è¿›è¡Œåˆ†æ­¥è¯´æ˜ï¼Œä½†ä½ å¯ä»¥é€‰æ‹©å…¶ä»–åŒ…ç®¡ç†å™¨ï¼Œå¹¶åœ¨å‘½ä»¤ä¸­ç›¸åº”åœ°æ›¿æ¢å®ƒã€‚

    å®‰è£…æœ€æ–°ç‰ˆæœ¬åï¼Œä½ å¯ä»¥ç»§ç»­ä½¿ç”¨ Tauri CLI åˆ›å»ºæ’ä»¶ã€‚

    <ShowSolution>
    ```sh
    mkdir -p tauri-learning
    cd tauri-learning
    cargo tauri plugin new test
    cd tauri-plugin-test
    pnpm install
    pnpm build
    cargo build
    ```
    </ShowSolution>

2. ### åˆ›å»ºä¸€ä¸ªæ–°å‘½ä»¤

    ä¸ºäº†å±•ç¤ºä¸€äº›å®ç”¨è€Œç®€å•çš„ä¸œè¥¿ï¼Œè®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬çš„å‘½ä»¤å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹
    å†™å…¥ä¸´æ—¶æ–‡ä»¶å¤¹å†…çš„æ–‡ä»¶ä¸­ï¼ŒåŒæ—¶å‘æ–‡ä»¶æ·»åŠ ä¸€äº›è‡ªå®šä¹‰æ ‡é¢˜ã€‚

    æˆ‘ä»¬å°†å‘½ä»¤å‘½åä¸º `write_custom_file` ï¼Œå¹¶åœ¨ `src/commands.rs` 
    ä¸­å®ç°å®ƒ å¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„æ’ä»¶æ„å»ºå™¨ä¸­ä»¥æš´éœ²ç»™å‰ç«¯ã€‚

    Tauri çš„æ ¸å¿ƒç¨‹åºå°†è‡ªåŠ¨ç”Ÿæˆæ­¤å‘½ä»¤çš„ `allow` å’Œ `deny` æƒé™ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒè¿™ä¸€ç‚¹ã€‚

    <ShowSolution>

    å‘½ä»¤å®ç°ï¼š

    ```rust title="src/commands.rs" ins={15-22} ins=", Manager"
    use tauri::{AppHandle, command, Runtime};

    use crate::models::*;
    use crate::Result;
    use crate::TestExt;

    #[command]
    pub(crate) async fn ping<R: Runtime>(
        app: AppHandle<R>,
        payload: PingRequest,
    ) -> Result<PingResponse> {
        app.test1().ping(payload)
    }

    #[command]
    pub(crate) async fn write_custom_file<R: Runtime>(
        user_input: String,
        app: AppHandle<R>,
    ) -> Result<String> {
        std::fs::write(app.path().temp_dir().unwrap(), user_input)?;
        Ok("success".to_string())
    }
   
    ```

    ä¸ºä½ çš„æ–°å‘½ä»¤è‡ªåŠ¨ç”Ÿæˆå†…ç½®æƒé™ï¼š

    ```rust title="src/build.rs" ins="\"write_custom_file\""
    const COMMANDS: &[&str] = &["ping", "write_custom_file"];
    ```

    è¿™äº›å†…ç½®æƒé™å°†ç”± Tauri æ„å»ºç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œå¹¶æ˜¾ç¤ºåœ¨ `permissions/autogenerated/commands` 
    æ–‡ä»¶å¤¹ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†åˆ›å»º `enable-<command>` å’Œ `deny-<command>` æƒé™ã€‚

    </ShowSolution>

3. ### å…¬å¼€æ–°å‘½ä»¤

    ä¸Šä¸€æ­¥æ˜¯ç¼–å†™å®é™…çš„å‘½ä»¤å®ç°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶æš´éœ²ç»™å‰ç«¯ï¼Œä»¥ä¾¿å…¶å¯ä»¥è¢«ä½¿ç”¨ã€‚

    <ShowSolution>

    é…ç½® Tauri æ„å»ºå™¨ä»¥ç”Ÿæˆè°ƒç”¨å¤„ç†ç¨‹åºï¼Œå°†å‰ç«¯ IPC è¯·æ±‚ä¼ é€’ç»™æ–°å®ç°çš„å‘½ä»¤ï¼š

    ```rust title="src/lib.rs"  ins="commands::write_custom_file,"
    pub fn init<R: Runtime>() -> TauriPlugin<R> {
        Builder::new("test")
            .invoke_handler(tauri::generate_handler![
                commands::ping,
                commands::write_custom_file,
            ])
            .setup(|app, api| {
                #[cfg(mobile)]
                let test = mobile::init(app, api)?;
                #[cfg(desktop)]
                let test = desktop::init(app, api)?;
                app.manage(test);

                // ç®¡ç†çŠ¶æ€ï¼Œä»¥ä¾¿å‘½ä»¤è®¿é—®
                app.manage(MyState::default());
                Ok(())
            })
            .build()
    }
    ```

    åœ¨å‰ç«¯æ¨¡å—ä¸­å…¬å¼€æ–°å‘½ä»¤ã€‚

    è¿™ä¸€æ­¥å¯¹äºç¤ºä¾‹åº”ç”¨ç¨‹åºæˆåŠŸå¯¼å…¥å‰ç«¯æ¨¡å—è‡³å…³é‡è¦ã€‚è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œ
    ä¸ä¼šå¯¹å®‰å…¨æ€§äº§ç”Ÿå½±å“ï¼Œå› ä¸ºå‘½ä»¤å¤„ç†ç¨‹åºå·²ç»ç”Ÿæˆï¼Œè¯¥å‘½ä»¤ä¹Ÿå¯ä»¥ä»å‰ç«¯æ‰‹åŠ¨è°ƒç”¨ã€‚

    ```ts title="guest-js/index.ts" ins={11-13}
    import { invoke } from '@tauri-apps/api/core'

    export async function ping(value: string): Promise<string | null> {
      return await invoke<{value?: string}>('plugin:test|ping', {
        payload: {
          value,
        },
      }).then((r) => (r.value ? r.value : null));
    }

    export async function writeCustomFile(user_input: string): Promise<string> {
      return await invoke('plugin:test|write_custom_file',{userInput: user_input});
    }
    ```

    :::tip 
    è°ƒç”¨å‚æ•°éœ€è¦é‡‡ç”¨é©¼å³°å‘½åæ³•ã€‚æœ¬ä¾‹ä¸­ï¼Œå®ƒæ˜¯ `userInput` è€Œä¸æ˜¯ `user_input` ã€‚
    :::

    ç¡®ä¿ä½ çš„åŒ…å·²ç»æ„å»ºï¼š

    ```
    pnpm build
    ```

    </ShowSolution>

4. ### å®šä¹‰é»˜è®¤æ’ä»¶æƒé™

    ç”±äºæˆ‘ä»¬çš„æ’ä»¶åº”è¯¥å…¬å¼€ `write_custom_file` å‘½ä»¤ï¼Œ
    å› æ­¤æˆ‘ä»¬åº”è¯¥å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„ `default.toml` æƒé™ä¸­ã€‚

    <ShowSolution>

    å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„é»˜è®¤æƒé™é›†ä»¥å…è®¸æˆ‘ä»¬åˆšåˆšå…¬å¼€çš„æ–°å‘½ä»¤æ­£å¸¸è¿è¡Œã€‚

    ```toml title="permissions/default.toml" ins=", \"allow-write-custom-file\""
    "$schema" = "schemas/schema.json"
    [default]
    description = "Default permissions for the plugin"
    permissions = ["allow-ping", "allow-write-custom-file"]
    ```
    </ShowSolution>

5. ### ä»ç¤ºä¾‹åº”ç”¨ç¨‹åºè°ƒç”¨æµ‹è¯•å‘½ä»¤
    
    åˆ›å»ºçš„æ’ä»¶ç›®å½•ç»“æ„åŒ…å«ä¸€ä¸ª `examples/tauri-app` æ–‡ä»¶å¤¹ï¼Œ
    å…¶ä¸­æœ‰ä¸€ä¸ªå¯ä¾›ä½¿ç”¨çš„ Tauri åº”ç”¨ç¨‹åºæ¥æµ‹è¯•è¯¥æ’ä»¶ã€‚

    ç”±äºæˆ‘ä»¬æ·»åŠ äº†æ–°å‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç¨å¾®ä¿®æ”¹å‰ç«¯æ¥è°ƒç”¨æˆ‘ä»¬çš„æ–°å‘½ä»¤ã€‚

    <ShowSolution>
    ```svelte title="src/App.svelte" del={11-13,42-45} ins={14-16,45-49}
    <script>
      import Greet from './lib/Greet.svelte'
      import { ping, writeCustomFile } from 'tauri-plugin-test-api'

      let response = ''

      function updateResponse(returnValue) {
        response += `[${new Date().toLocaleTimeString()}]` + (typeof returnValue === 'string' ? returnValue : JSON.stringify(returnValue)) + '<br>'
      }

      function _ping() {
        ping("Pong!").then(updateResponse).catch(updateResponse)
      }
      function _writeCustomFile() {
        writeCustomFile("HELLO FROM TAURI PLUGIN").then(updateResponse).catch(updateResponse)
      }
    </script>

    <main class="container">
      <h1>Welcome to Tauri!</h1>

      <div class="row">
        <a href="https://vitejs.dev" target="_blank">
          <img src="/vite.svg" class="logo vite" alt="Vite Logo" />
        </a>
        <a href="https://tauri.app" target="_blank">
          <img src="/tauri.svg" class="logo tauri" alt="Tauri Logo" />
        </a>
        <a href="https://svelte.dev" target="_blank">
          <img src="/svelte.svg" class="logo svelte" alt="Svelte Logo" />
        </a>
      </div>

      <p>
        Click on the Tauri, Vite, and Svelte logos to learn more.
      </p>

      <div class="row">
        <Greet />
      </div>

      <div>
        <button on:click="{_ping}">Ping</button>
        <div>{@html response}</div>
      </div>
      <div>
        <button on:click="{_writeCustomFile}">Write</button>
        <div>{@html response}</div>
      </div>


    </main>

    <style>
      .logo.vite:hover {
        filter: drop-shadow(0 0 2em #747bff);
      }

      .logo.svelte:hover {
        filter: drop-shadow(0 0 2em #ff3e00);
      }
    </style>
    ```

    è¿è¡Œæ­¤ç¨‹åºå¹¶æŒ‰ä¸‹â€œWriteâ€æŒ‰é’®ï¼Œä½ å°†çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š

    ```
    success
    ```

    ä½ åº”è¯¥åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ä¸€ä¸ª `test.txt` æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªæˆ‘ä»¬æ–°å®ç°çš„æ’ä»¶å‘½ä»¤çš„æ¶ˆæ¯ã€‚ğŸ¥³

    </ShowSolution>

 </Steps>   
