---
title: ä½¿ç”¨æ’ä»¶æƒé™
sidebar:
  order: 10
i18nReady: true
---

import { Steps } from '@astrojs/starlight/components';
import ShowSolution from '@components/ShowSolution.astro'
import Cta from '@fragments/cta.mdx';

æœ¬å®éªŒçš„ç›®æ ‡æ˜¯æ›´å¥½åœ°äº†è§£å¦‚ä½•å¯ç”¨æˆ–ç¦ç”¨æ’ä»¶æƒé™ã€åœ¨å“ªé‡Œæè¿°å®ƒä»¬ä»¥åŠå¦‚ä½•ä½¿ç”¨æ’ä»¶çš„é»˜è®¤æƒé™ã€‚

æœ€åï¼Œä½ å°†èƒ½å¤ŸæŸ¥æ‰¾å’Œä½¿ç”¨ä»»æ„æ’ä»¶çš„æƒé™ï¼Œå¹¶äº†è§£å¦‚ä½•è‡ªå®šä¹‰ç°æœ‰æƒé™ã€‚
ä½ å°†è·å¾—ä¸€ä¸ª Tauri ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­ä½¿ç”¨äº†ä¸€ä¸ªæ’ä»¶å’Œæ’ä»¶ç‰¹å®šçš„æƒé™ã€‚

<Steps>

1. ### åˆ›å»º Tauri åº”ç”¨ç¨‹åº

    åˆ›å»ºä½ çš„ Tauri åº”ç”¨ç¨‹åºã€‚
    åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [`create-tauri-app`](https://github.com/tauri-apps/create-tauri-app) ï¼š

    <Cta />

    æˆ‘ä»¬å°†ä½¿ç”¨ `pnpm` è¿›è¡Œé€æ­¥è§£é‡Šï¼Œä½†ä½ å¯ä»¥é€‰æ‹©å…¶ä»–åŒ…ç®¡ç†å™¨å¹¶åœ¨å‘½ä»¤ä¸­ç›¸åº”åœ°æ›¿æ¢å®ƒã€‚


    <ShowSolution>
    ```
    pnpm create tauri-app
    ```

    ```
    âœ” Project name Â· plugin-permission-demo
    âœ” Choose which language to use for your frontend Â· TypeScript / JavaScript - (pnpm, yarn, npm, bun)
    âœ” Choose your package manager Â· pnpm
    âœ” Choose your UI template Â· Vanilla
    âœ” Choose your UI flavor Â· TypeScript

    Template created! To get started run:
    cd plugin-permission-demo
    pnpm install
    pnpm tauri dev
    ```
    </ShowSolution>

2. ### å°† `file-system` æ’ä»¶æ·»åŠ åˆ°ä½ çš„åº”ç”¨ç¨‹åºä¸­

    è¦æœç´¢ç°æœ‰çš„æ’ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å¤šä¸ªèµ„æºã€‚

    æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯æ£€æŸ¥ä½ çš„æ’ä»¶æ˜¯å¦å·²åœ¨æ–‡æ¡£çš„ [æ’ä»¶](/plugin/) éƒ¨åˆ†ä¸­ï¼Œ
    æ­¤å¤„æ˜¯ Tauri ç»´æŠ¤çš„æ’ä»¶é›†çš„ä¸€éƒ¨åˆ†ã€‚
    æ–‡ä»¶ç³»ç»Ÿæ’ä»¶æ˜¯ Tauri æ’ä»¶å·¥ä½œåŒºçš„ä¸€éƒ¨åˆ†ï¼Œä½ å¯ä»¥æŒ‰ç…§ [è®¾ç½®](/plugin/file-system/#permission-table) å°†å…¶æ·»åŠ åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚

    å¦‚æœè¯¥æ’ä»¶æ˜¯ç¤¾åŒºåŠªåŠ›çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆä½ æœ€æœ‰å¯èƒ½åœ¨ [crates.io](https://crates.io/search?q=tauri-plugin-) 
    ä¸Šæœç´¢ `tauri-plugin-<your plugin name>` æ—¶æ‰¾åˆ°å®ƒã€‚

    <ShowSolution>
    å¦‚æœå®ƒæ˜¯æˆ‘ä»¬å·¥ä½œåŒºä¸­ç°æœ‰çš„æ’ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–æ–¹å¼ï¼š

    ```
    pnpm tauri add fs
    ```

    å¦‚æœä½ åœ¨ [crates.io](https://crates.io/crates/tauri-plugin-fs) ä¸Šæ‰¾åˆ°å®ƒ
    ä½ éœ€è¦æ‰‹åŠ¨å°†å…¶æ·»åŠ ä¸ºä¾èµ–é¡¹å¹¶ä¿®æ”¹ Tauri æ„å»ºå™¨åˆå§‹åŒ–æ’ä»¶ï¼š

    ```sh
    cargo add tauri-plugin-fs
    ```

    ä¿®æ”¹ `lib.rs` æ¥åˆå§‹åŒ–æ’ä»¶:

    ```rust title="src-tauri/src/lib.rs" ins={4}
    #[cfg_attr(mobile, tauri::mobile_entry_point)]
    fn run() {
        tauri::Builder::default()
            .plugin(tauri_plugin_fs::init())
            .run(tauri::generate_context!())
            .expect("error while running tauri application");
    }
    ```
    </ShowSolution>

3. ### äº†è§£ `fs` æ’ä»¶çš„é»˜è®¤æƒé™
    
    æ¯ä¸ªæ’ä»¶éƒ½æœ‰ä¸€ç»„ `default` æƒé™é›†ï¼Œå…¶ä¸­åŒ…å«ä½¿ç”¨æ’ä»¶æ‰€éœ€çš„æ‰€æœ‰æƒé™å’ŒèŒƒå›´ï¼Œ
    ä»¥åŠä½¿ç”¨æ’ä»¶çš„åˆç†çš„æœ€å°åŠŸèƒ½é›†ã€‚
    
    å¯¹äºå®˜æ–¹ç»´æŠ¤çš„æ’ä»¶ï¼Œä½ å¯ä»¥åœ¨æ–‡æ¡£ä¸­æ‰¾åˆ°ç›¸å…³æè¿°
    ï¼ˆä¾‹å¦‚ [fs default](/plugin/file-system/#default-permission) ï¼‰ã€‚

    In case you are figuring this out for a community plugin you
    need to check out the source code of the plugin.
    This should be defined in `your-plugin/permissions/default.toml`.
    å¦‚æœä½ è¦æŸ¥çœ‹ç¤¾åŒºæ’ä»¶çš„é»˜è®¤æƒé™é›†ï¼Œåˆ™éœ€è¦æŸ¥çœ‹è¯¥æ’ä»¶çš„æºä»£ç ã€‚
    è¿™åº”è¯¥åœ¨ `your-plugin/permissions/default.toml` ä¸­å®šä¹‰ã€‚

    <ShowSolution>
    ```toml
    "$schema" = "schemas/schema.json"

    [default]
    description = """
    # Tauri `fs` æ’ä»¶çš„é»˜è®¤æƒé™é›†

    è¿™ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰äº†æˆäºˆæ–‡ä»¶ç³»ç»Ÿçš„é»˜è®¤æƒé™ã€‚

    ### å·²æˆäºˆçš„æƒé™

    è¿™ä¸ªé»˜è®¤çš„æƒé™é›†å¯ç”¨äº†æ‰€æœ‰ä¸è¯»å–ç›¸å…³çš„å‘½ä»¤ï¼Œ
    å¹¶å…è®¸è®¿é—® `$APP` æ–‡ä»¶å¤¹åŠå…¶åœ¨è¿è¡Œæ—¶åˆ›å»ºçš„å­ç›®å½•ã€‚
    `$APP` æ–‡ä»¶å¤¹çš„å…·ä½“ä½ç½®å–å†³äºæ“ä½œç³»ç»Ÿä»¥åŠåº”ç”¨ç¨‹åºçš„è¿è¡Œæ–¹å¼ã€‚

    ä¸€èˆ¬æ¥è¯´ï¼Œ`$APP` æ–‡ä»¶å¤¹éœ€è¦ç”±åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶æ‰‹åŠ¨åˆ›å»ºï¼Œä¹‹åæ‰èƒ½è®¿é—®å…¶ä¸­çš„æ–‡ä»¶æˆ–å­ç›®å½•ã€‚

    ### è¢«æ‹’ç»çš„æƒé™

    è¯¥é»˜è®¤æƒé™é›†é»˜è®¤é˜»æ­¢å¯¹ Tauri åº”ç”¨ç¨‹åºä¸­å…³é”®ç»„ä»¶çš„è®¿é—®ã€‚
    åœ¨ Windows ä¸Šï¼Œé»˜è®¤ä¼šç¦æ­¢è®¿é—® WebView æ•°æ®æ–‡ä»¶å¤¹ ã€‚

    """
    permissions = ["read-all", "scope-app-recursive", "deny-default"]

    ```
    </ShowSolution>

4. ### æ‰¾åˆ°æ­£ç¡®çš„æƒé™
      
    æ­¤æ­¥éª¤æ˜¯å…³äºæ‰¾åˆ°ä½ éœ€è¦çš„æƒé™ï¼Œä»¥ä¾¿ä»¥æœ€å°‘çš„ç³»ç»Ÿè®¿é—®æƒé™å°†å®ç°ä½ çš„å‘½ä»¤å¹¶å…¬å¼€åˆ°å‰ç«¯ã€‚

    `fs` æ’ä»¶å…·æœ‰è‡ªåŠ¨ç”Ÿæˆçš„æƒé™ï¼Œå¯ä»¥ç¦ç”¨æˆ–å¯ç”¨å•ä¸ªå‘½ä»¤å¹¶å…è®¸æˆ–ç¦ç”¨å…¨å±€èŒƒå›´ã€‚

    è¿™äº›å¯ä»¥åœ¨ [æ–‡æ¡£](/plugin/file-system/#permission-table) ä¸­æ‰¾åˆ°ï¼Œ
    ä¹Ÿå¯ä»¥åœ¨æ’ä»¶æºä»£ç ä¸­æ‰¾åˆ°ï¼ˆ`fs/permissions/autogenerated`ï¼‰ã€‚

    å‡è®¾æˆ‘ä»¬æƒ³è¦å¯ç”¨å†™å…¥ä½äºç”¨æˆ·çš„ `$HOME` æ–‡ä»¶å¤¹ä¸­çš„æ–‡æœ¬æ–‡ä»¶ `test.txt`ã€‚

    ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨è‡ªåŠ¨ç”Ÿæˆçš„æƒé™ä¸­æœç´¢å…è®¸å†™å…¥æ–‡æœ¬æ–‡ä»¶çš„æƒé™ï¼Œ
    ä¾‹å¦‚ `allow-write-text-file` ï¼Œç„¶åæ˜¯å…è®¸æˆ‘ä»¬è®¿é—® `$HOME/test.txt` èŒƒå›´å†…çš„æ–‡ä»¶ã€‚

    æˆ‘ä»¬éœ€è¦å°†è¿™äº›æ·»åŠ åˆ°æˆ‘ä»¬çš„ `capabilities` éƒ¨åˆ†ï¼Œåœ¨ `src-tauri/tauri.conf.json` 
    æ–‡ä»¶ä¸­æˆ– `src-tauri/capabilities/` æ–‡ä»¶å¤¹ä¸­çš„æŸä¸ªæ–‡ä»¶ã€‚
    é»˜è®¤æƒ…å†µä¸‹ï¼Œ `src-tauri/capabilities/default.json` ä¸­å·²åŒ…å«æˆ‘ä»¬å¯ä»¥ä¿®æ”¹çš„æƒé™ã€‚

    <ShowSolution>

    ```json title="src-tauri/capabilities/default.json" del={18} ins={19}
    {
      "$schema": "../gen/schemas/desktop-schema.json",
      "identifier": "default",
      "description": "Capability for the main window",
      "windows": [
        "main"
      ],
      "permissions": [
        "path:default",
        "event:default",
        "window:default",
        "app:default",
        "image:default",
        "resources:default",
        "menu:default",
        "tray:default",
        "shell:allow-open",
        "fs:default",
        "fs:allow-write-text-file",
      ]
    }
    ```

    </ShowSolution>

    ç”±äº `fs` æ’ä»¶ä¸­åªæœ‰è‡ªåŠ¨ç”Ÿæˆçš„èŒƒå›´å¯ä»¥è®¿é—®å®Œæ•´çš„ `$HOME` æ–‡ä»¶å¤¹ï¼Œ
    å› æ­¤æˆ‘ä»¬éœ€è¦é…ç½®è‡ªå·±çš„èŒƒå›´ã€‚æ­¤èŒƒå›´åº”ä»…å¯¹ `write-text-file` å‘½ä»¤å¯ç”¨ï¼Œ
    å¹¶ä¸”åº”ä»…åŒ…å«æˆ‘ä»¬çš„ `test.txt` æ–‡ä»¶ã€‚

    <ShowSolution>
    ```json title="src-tauri/capabilities/default.json" del={18} ins={19-22}
       {
      "$schema": "../gen/schemas/desktop-schema.json",
      "identifier": "default",
      "description": "Capability for the main window",
      "windows": [
        "main"
      ],
      "permissions": [
        "path:default",
        "event:default",
        "window:default",
        "app:default",
        "image:default",
        "resources:default",
        "menu:default",
        "tray:default",
        "shell:allow-open",
        "fs:allow-write-text-file",
        {
          "identifier": "fs:allow-write-text-file",
          "allow": [{ "path": "$HOME/test.txt" }]
        },
      ]
    }
    ```
    </ShowSolution>
    
5. ### åœ¨å®è·µä¸­æµ‹è¯•æƒé™

    æ·»åŠ å¿…è¦çš„æƒé™åï¼Œæˆ‘ä»¬è¦ç¡®è®¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®è¯¥æ–‡ä»¶å¹¶å†™å…¥å…¶å†…å®¹ã€‚

    <ShowSolution>
    æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™ä¸ªä»£ç ç‰‡æ®µæ¥å†™å…¥æ–‡ä»¶ï¼š

    ```ts title="src/main.ts"
    import { writeTextFile, BaseDirectory } from '@tauri-apps/plugin-fs';

    let greetInputEl: HTMLInputElement | null;

    async function write(message: string) {
        await writeTextFile('test.txt', message, { baseDir: BaseDirectory.Home });
    }

    window.addEventListener("DOMContentLoaded", () => {
        greetInputEl = document.querySelector("#greet-input");
        document.querySelector("#greet-form")?.addEventListener("submit", (e) => {
            e.preventDefault();
            if (!greetInputEl )
                return;

            write(greetInputEl.value == "" ? "No input provided": greetInputEl.value);

        });
    });

    ```

    ç”¨è¿™æ®µä»£ç æ›¿æ¢ `src/main.ts` æ„å‘³ç€åœ¨ä½¿ç”¨ä¸€èˆ¬çš„ Vanilla+Typescript 
    åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬æ— éœ€ä¿®æ”¹é»˜è®¤çš„ `index.html` ã€‚
    åœ¨è¿è¡Œä¸­çš„åº”ç”¨ä¸­çš„è¾“å…¥æ¡†è¾“å…¥ä»»ä½•å†…å®¹ï¼Œæäº¤åéƒ½ä¼šå†™å…¥æ–‡ä»¶ä¸­ã€‚

    è®©æˆ‘ä»¬æ¥å®é™…æµ‹è¯•ä¸€ä¸‹ï¼š

    ```
    pnpm run tauri dev
    ```

    å†™å…¥è¾“å…¥æ¡†å¹¶å•å‡»â€œæäº¤â€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»ˆç«¯æˆ–æ‰‹åŠ¨æ‰“å¼€ä¸»æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶è¿›è¡Œæ£€æŸ¥ã€‚

    ```
    cat $HOME/test.txt
    ```

    ä½ åº”è¯¥ä¼šçœ‹åˆ°ä½ çš„è¾“å…¥ï¼Œç„¶åå°±å®Œæˆäº†æœ‰å…³åœ¨ Tauri åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ’ä»¶æƒé™çš„å­¦ä¹ ã€‚ğŸ¥³


    å¦‚æœä½ é‡åˆ°æ­¤é”™è¯¯ï¼š

    ```sh
    [Error] Unhandled Promise Rejection: fs.write_text_file not allowed. Permissions associated with this command: fs:allow-app-write, fs:allow-app-write-recursive, fs:allow-appcache-write, fs:allow-appcache-write-recursive, fs:allow-appconf...
    (anonymous function) (main.ts:5)
    ```
    é‚£ä¹ˆä½ å¾ˆå¯èƒ½æ²¡æœ‰æ­£ç¡®éµå¾ª [å…ˆå‰çš„æŒ‡ç¤º](#æ‰¾åˆ°æ­£ç¡®çš„æƒé™).

    </ShowSolution>

 </Steps>   
